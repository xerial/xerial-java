<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     Sep 10, 2007 9:33:22 AM                                                        

     xerial-core project    
     build task definition for xerial-core project
                   
     leo                                                                
     ====================================================================== -->
<project name="xerial-core project" default="default">
    <description>
            build task definition for xerial-core project
    </description>

	<property name="src" value="src/main/java"/>
	<property name="test" value="src/test/java"/>
	<property name="build" value="target/classes"/>

	<!-- set classpath -->
 	<path id="project.classpath">
		<pathelement path="${java.classpath}/" />
		<pathelement path="${src}"/>
		<pathelement path="${test}"/>
		<pathelement path="${build}"/>
		<pathelement path="${maven.classpath}"/>
	</path>

    <!-- ================================= 
          target: default              
         ================================= -->
    <target name="default" depends="depends" description="--> build task definition for xerial-wiki project">
		<antcall target="generate-parser"/>
    </target>

    <!-- - - - - - - - - - - - - - - - - - 
          target: depends                      
         - - - - - - - - - - - - - - - - - -->
    <target name="depends">
		<fail unless="maven.classpath">This build file cannot be used outside of the maven environment. Use mvn compile instead</fail>
    </target>


	<target name="generate-parser">
		<antcall target="antlr">
			<param name="antlr.input.dir" value="${src}/org/xerial/amoeba/query"/>
			<param name="antlr.input.src" value="AmoebaQuery.g"/>
		</antcall>
		<antcall target="antlr">
			<param name="antlr.input.dir" value="${src}/org/xerial/amoeba/query"/>
			<param name="antlr.input.src" value="AmoebaQueryTreeParser.g"/>
		</antcall>
		<antcall target="antlr">
			<param name="antlr.input.dir" value="${src}/org/xerial/json"/>
			<param name="antlr.input.src" value="JSON.g"/>
		</antcall>
		<antcall target="antlr">
			<param name="antlr.input.dir" value="${src}/org/xerial/json"/>
			<param name="antlr.input.src" value="JSONWalker.g"/>
		</antcall>
		<antcall target="antlr">
			<param name="antlr.input.dir" value="${src}/org/xerial/util/xml/dtd"/>
			<param name="antlr.input.src" value="DTD.g"/>
		</antcall>
	</target>
	
	<target name="checkUpToDate">
		<fail unless="antlr.input.dir">no input directory</fail>
		<fail unless="antlr.input.src">no input grammar file</fail>
		<uptodate property="antlr.build.notRequired" srcfile="${antlr.input.dir}/${antlr.input.src}">
			<mapper type="glob" from="*.g" to="*.tokens"/>
		</uptodate>
	</target>
	
	<target name="antlr" depends="checkUpToDate" unless="antlr.build.notRequired">
		<echo>input: ${antlr.input.src}</echo>
		<java classpathref="project.classpath" classname="org.antlr.Tool" fork="true" dir="${antlr.input.dir}">
			<jvmarg value="-Xmx300M"/>
			<arg value="-message-format"/>
			<arg value="antlr"/>
			<arg value="${antlr.input.src}"/>
		</java>
	</target>

	
</project>
